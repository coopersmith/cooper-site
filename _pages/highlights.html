---
layout: page
title: Highlights
permalink: /highlights
---

<div id="highlights"></div>
<script>
async function loadHighlights() {
  const container = document.getElementById('highlights');
  try {
    const response = await fetch('/.netlify/functions/readwise-highlights');
    if (!response.ok) {
      const errorText = await response.text();
      console.error('API Error:', response.status, errorText);
      container.textContent = `Error loading highlights: ${response.status}`;
      return;
    }
    const highlights = await response.json();
    console.log('Received highlights:', highlights);
    
    if (!Array.isArray(highlights) || highlights.length === 0) {
      container.textContent = 'No highlights found.';
      return;
    }
    
    highlights.forEach(h => {
      const item = document.createElement('div');
      item.className = 'highlight';
      
      // Build comprehensive attribution
      let attribution = '';
      let attributionHtml = '';
      
      // Primary attribution: book title and author
      if (h.book_title) {
        attribution = h.book_title;
        if (h.author) {
          attribution += ` by ${h.author}`;
        }
      } else if (h.source) {
        attribution = h.source;
      }
      
      // Create linkified attribution if original source URL is available
      if (attribution) {
        // Prioritize source_url (original article) over url (Readwise highlight page)
        const linkUrl = h.source_url || h.url;
        if (linkUrl && linkUrl.startsWith('http')) {
          attributionHtml = `<a href="${linkUrl}" target="_blank" rel="noopener">${attribution}</a>`;
        } else {
          attributionHtml = attribution;
        }
      }
      
      item.innerHTML = `
        <blockquote>
          <p>${h.text}</p>
          ${attributionHtml ? `<cite>â€” ${attributionHtml}</cite>` : ''}
        </blockquote>
      `;
      container.appendChild(item);
    });
  } catch (error) {
    console.error('Failed to load highlights:', error);
    container.textContent = 'Failed to load highlights.';
  }
}
loadHighlights();
</script>
